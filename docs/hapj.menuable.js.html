<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JSDoc: Source: ui/hapj.menuable.js</title>

<script src="scripts/prettify/prettify.js"> </script>
<script src="scripts/prettify/lang-css.js"> </script>
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
<link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

<h1 class="page-title">Source: ui/hapj.menuable.js</h1>




    
    <section>
        <article>
            <pre class="prettyprint source"><code>/** 
 * Copyright (c) 2014, Jiehun.com.cn Inc. All Rights Reserved
 * @class jQuery.fn.menuable
 * @author ronnie&lt;dengxiaolong@jiehun.com.cn>
 * @date 2011-12-30
 * @version 1.0 
 * @description 使元素能像菜单一样，通过点击或者按键显示出来以后，当鼠标点击在该元素上时，元素不会消失，但当鼠标点击在该元素以外时，元素会消失；
 * 当按esc键时，最上层的元素会消失
 * @example 
var menu = $('#dialog').menuable();
$('#linkDialog').on('click', function(e){
  menu.show(e, function(e){
    // set menu's position
    dlg.floable(window).middle().center();
    // return false if the dialog is not allowed to show
  });
});
 **/
!function($, _d, _w, undefined){
	"use strict";
	
	var elemQueue = [],
	_idKey = 'floableId',
	_idCount = 1000,
	_getId = function(){
		return 'FLOATBLE_' + (_idCount++);
	},
	_inited = false,
	_init = function(){
		if (_inited) {
			return;
		}
		_inited = true;
		$(_d).on('click', function(e){
			if (undefined !== e.button && e.button == 2) {
				return _initClicks();
			}
			
			var t = e.target;
			if (t === _from) {
				return _initClicks();
			}
			for(var elem in elemQueue) {
				if (!(elem in _clicks)) {
					elemQueue[elem].hide();
				}
			}
			return _initClicks();
		}).on('keydown', function(e) {
			var lastId = '';
			for(lastId in _currents) {}
			if (!lastId) {
				return;
			}
			
			if (e.keyCode == 27) {
				var c = elemQueue[lastId];
				c && c.hide();
			}
		});
	},
	_from = null,
	_currents = {},
	_clicks = {},
	_initClicks = function() {
		_clicks = {};
	}
	;

	/**
	 * 构造函数
	 * @returns {object} 返回一个对象，包含两个函数
	 * @example 返回的对象为
	 * {
	 *   // 显示菜单
	 *   show:function(event, onShow),
	 *   // 隐藏菜单
	 *   hide:function(event, onHide)
	 * }
	 */
	$.fn.menuable = function() {
		if (!this.length) {
			return;
		}
		_init();
		var me = new Me(),id = _getId();
		elemQueue[id] = me;
		
		var self = this;
		this.attr(_idKey, id).on('click', function(){
			_clicks[this.getAttribute(_idKey)] = true;
		});
		me.ui = self;
		
		return me;
	};

	var Me = function(){};
	
	Me.prototype = /** @lends jQuery.fn.menuable.prototype*/{
		/**
		 * 显示元素
		 * @param {Event} e
		 * @param {Function} onShow
		 * @return menuable
		 */
		show: function(e, onShow) {
			var id = this.ui.attr(_idKey);
			if (id in _currents) {
				return;
			}
		
			_from = null;
			if (undefined !== e && e.target) {
				_from = e.target;
			}
			if (typeof onShow == 'function') {
				var ret = onShow.call(this, e);
				if (false === ret) {
					return this;
				}
			}
			this.ui.css('display', 'block');
			
			if (id in _currents) {
				delete _currents[id];
			}
			_currents[id] = true;
			return this;
		},
		/**
		 * 隐藏元素
		 * @param {Event} e
		 * @param {Function} onHide
		 * @return menuable
		 */
		hide: function(e, onHide) {
			if (typeof onHide == 'function') {
				var ret = onHide.call(this.ui, e);
				if (false === ret) {
					return this;
				}
			}
			this.ui.css('display', 'none');
			var id = this.ui.attr(_idKey);
			if (id in _currents) {
				delete _currents[id];
			}
			return this;
		}
	};
}(jQuery, document, window);</code></pre>
        </article>
    </section>




</div>

<nav>
<h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="hapj.array.html">hapj.array</a></li><li><a href="hapj.browser.html">hapj.browser</a></li><li><a href="hapj.cache.html">hapj.cache</a></li><li><a href="hapj.conf.html">hapj.conf</a></li><li><a href="hapj.date.html">hapj.date</a></li><li><a href="hapj.json.html">hapj.json</a></li><li><a href="hapj.log.html">hapj.log</a></li><li><a href="hapj.object.html">hapj.object</a></li><li><a href="hapj.page.html">hapj.page</a></li><li><a href="hapj.string.html">hapj.string</a></li><li><a href="jQuery.html">jQuery</a></li><li><a href="jQuery.ajaxable.html">jQuery.ajaxable</a></li><li><a href="jQuery.fn.html">jQuery.fn</a></li><li><a href="jQuery.verifiable.html">jQuery.verifiable</a></li></ul><h3>Classes</h3><ul><li><a href="hapj.html">hapj</a></li><li><a href="hapj.ajax.html">hapj.ajax</a></li><li><a href="hapj.ui.html">hapj.ui</a></li><li><a href="hapj.ui.fn.html">hapj.ui.fn</a></li><li><a href="jQuery.fn.ajaxable.html">jQuery.fn.ajaxable</a></li><li><a href="jQuery.fn.calendar.html">jQuery.fn.calendar</a></li><li><a href="jQuery.fn.floatable.html">jQuery.fn.floatable</a></li><li><a href="jQuery.fn.lazyload.html">jQuery.fn.lazyload</a></li><li><a href="jQuery.fn.menuable.html">jQuery.fn.menuable</a></li><li><a href="jQuery.fn.selectable.html">jQuery.fn.selectable</a></li><li><a href="jQuery.fn.suggestable.html">jQuery.fn.suggestable</a></li><li><a href="jQuery.fn.switchable.html">jQuery.fn.switchable</a></li><li><a href="jQuery.fn.verifiable.html">jQuery.fn.verifiable</a></li><li><a href="jQuery.verifiable.rules.html">jQuery.verifiable.rules</a></li></ul>
</nav>

<br clear="both">

<footer>
Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Thu Sep 25 2014 20:22:51 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
