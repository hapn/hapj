<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JSDoc: Source: ui/hapj.selectable.js</title>

<script src="scripts/prettify/prettify.js"> </script>
<script src="scripts/prettify/lang-css.js"> </script>
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
<link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

<h1 class="page-title">Source: ui/hapj.selectable.js</h1>




    
    <section>
        <article>
            <pre class="prettyprint source"><code>/** 
 * Copyright (c) 2012, Jiehun.com.cn Inc. All Rights Reserved
 * @author dengxiaolong@jiehun.com.cn
 * @date 2011-12-30
 * @version 1.0 
 * @brief 映射下拉框到可定制的下拉组件
 **/
!function($, Me, undefined){
	'use strict';
var defaults = {
	selectedClassName:'on',
	showEvent:'click',
	pack:null,
	hideDelayTime:1000,  // 隐藏延迟的时间，只有showEvent为mouseover或mouseenter才有效，如果该值小于0，则不会自动掩藏
	onHide:null,
	onShow:null,
	onChange:null
};
/**
 * @class jQuery.fn.selectable
 * @description 主要用来将普通的下拉框组件(或ul)转化为可以自定义样式的下拉框组件。绑定到原有下拉框的事件也会起作用。
 * @param options 配置参数，目前支持的有：
 * &lt;dl>
 *  &lt;dt>selectedClassName:&lt;em>string&lt;/em>&lt;/dt>
 *  &lt;dd>表示选中时的样式名称，默认为on&lt;/dd>
 *  &lt;dt>showEvent:&lt;em>string&lt;/em>&lt;/dt>
 *  &lt;dd>用来显示菜单的事件，可选值为mouseover、mouseenter、click，默认为click。&lt;/dd>
 *  &lt;dt>pack:&lt;em>function(o)&lt;/em>&lt;/dt>
 *  &lt;dd>用来设定选择选项后显示的文字&lt;br/>&lt;label>o&lt;/label>被选中的option或被选中的li&lt;/dd>
 *  &lt;dt>hideDelayTime:&lt;em>Int&lt;/em>&lt;/dt>
 *  &lt;dd>隐藏延迟的时间，只有showEvent为mouseover或mouseenter才有效，如果该值小于0，则不会自动掩藏&lt;/dd>
 *  &lt;dt>onShow:&lt;em>function()&lt;/em>&lt;/dt>
 *  &lt;dd>显示时调用的事件&lt;/dd>
 *  &lt;dt>onHide:&lt;em>function()&lt;/em>&lt;/dt>
 *  &lt;dd>隐藏时调用的方法&lt;/dd>
 *  &lt;dt>onChange:&lt;em>function()&lt;/em>&lt;/dt>
 *  &lt;dd>更改时调用的方法&lt;/dd>
 * &lt;/dl>
 * @example
 * 详细的例子参考&lt;a href="../examples/selectable.html" target="_blank">例子&lt;/a>
&lt;select&gt;
	&lt;option&gt;条目1&lt;/option&gt;
	&lt;option&gt;条目2&lt;/option&gt;
	&lt;option&gt;条目3&lt;/option&gt;
&lt;/select&gt;

&lt;script&gt;
$('select').on('change', function(){
	alert('change');
}).selectable({
	pack:function(o) {
		return '搜索' + o.text;
	}
});
&lt/script&gt;

 */
$.fn.selectable = function(options){
	this.each(function(k, v){
		if (v.tagName != 'UL' && v.tagName != 'SELECT') {
			return;
		}
		var s = new Select();
		s.type = v.tagName.toLowerCase();
		var o = {};
		$.extend(o, defaults);
		s.options = $.extend(o, options || {});
		s.init(v);
	});
	return this;
};

var Select = function() {};
Select.prototype = {
	init: function(elem) {
		this.elem = elem;
		this._options = this.type == 'ul' ? $(this.elem).find('>li') : this.elem.options;
		this.length = this._options.length;
		
		// 获取原有select控件的基本属性
		this.dom = $('&lt;dl>').addClass(this.elem.className);
		this.dom.html(this.buildHtml());
		
		this.dom.insertBefore(elem);
		this.bindEvents();
		this.elem.style.display = 'none';
		
		if (this.type == 'select') {
			if (this.elem.selectedIndex > -1) {
				this.select(this.elem.selectedIndex);
			}
		} else {
			var self = this;
			this._options.each(function(i){
				if (this.className == self.options.selectedClassName) {
					self.select(i);
				}
			});
		}
	},
	length:0,
	buildHtml: function() {
		var ret = [], lh = '';
		if (this.length > 8) {
			lh = ' style="height:150px;overflow:auto;overflow-x:hidden;"';
		}
		ret.push('&lt;dt>&lt;label>&lt;/label>&lt;a>&lt;/a>&lt;/dt>');
		ret.push('&lt;dd style="display:none">&lt;ul' + lh + '>');
		for(var i = 0; i &lt; this.length; i++) {
			ret.push('&lt;li index="' + i + '">' + (this._options[i].text || this._options[i].innerHTML) + '&lt;/li>');
		}
		ret.push('&lt;/ul>&lt;/dd>');
		return ret.join('');
	},
	bindEvents: function(){
		var self = this, sevent = this.options.showEvent, inMe = false;
		// 绑定dt事件
		this.dom.find('dt').on(sevent, function(e) {
			if(inMe===false){
				inMe = true;
				self.dom.find('dd').fadeIn('fast');
				self.options.onShow && self.options.onShow();
			}else{
				inMe = false;
				self.dom.find('dd').fadeOut('fast');
				self.options.onHide && self.options.onHide();
			}
			
			e.stopPropagation();
		});
		if (sevent != 'click') {
			this.dom.find('dt').click(function(){
				return false;
			});
		}
		
		if (self.options.hideDelayTime >= 0 && (sevent == 'mouseover' || sevent == 'mouseenter')) {
			this.dom.on('mouseleave', function() {
				inMe = false;
				setTimeout(function() {
					if (!inMe) {
						self.dom.find('dd').fadeOut('fast');
						self.options.onHide && self.options.onHide();
					}
				}, self.options.hideDelayTime);
			});
		}
			$(document).click(function() {
				inMe = false;
				self.dom.find('dd').fadeOut('fast');
				self.options.onHide && self.options.onHide();
			});
		
		// 绑定dd事件
		this.dom.on('click', 'li', function(e) {
			inMe = false;
			self.select(e.target.getAttribute('index'));
			e.stopPropagation();
			self.dom.find('dd').fadeOut('fast');
		});
		
		if (this.type == 'ul' && this._options.find('a').length) {
			this.dom.on('mouseover', 'a', function(e) {
				e.target.parentNode.className = self.options.selectedClassName;
			});
			this.dom.on('mouseout', 'a', function(e) {
				e.target.parentNode.className = '';
			});
		}
		this.dom.on('mouseover', 'li', function(e) {
			e.target.className = self.options.selectedClassName;
		});
		this.dom.on('mouseout', 'li', function(e) {
			e.target.className = '';
		});
	},
	select: function(i) {
		var option = this._options[i], txt;
		if (this.type == 'select') {
			this.elem.selectedIndex = i;
		}
		if (this.options.pack) {
			txt = this.options.pack(option);
		} else {
			txt = option.text || $(option).text();
		}
		this.dom.find('dt > label').html(txt);
		
		if (this.type == 'select') {
			$(this.elem).trigger('change');
		} else {
			this.options.onChange && this.options.onChange(txt);
		}
	}
};
}(jQuery);</code></pre>
        </article>
    </section>




</div>

<nav>
<h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="hapj.array.html">hapj.array</a></li><li><a href="hapj.browser.html">hapj.browser</a></li><li><a href="hapj.cache.html">hapj.cache</a></li><li><a href="hapj.conf.html">hapj.conf</a></li><li><a href="hapj.date.html">hapj.date</a></li><li><a href="hapj.json.html">hapj.json</a></li><li><a href="hapj.log.html">hapj.log</a></li><li><a href="hapj.object.html">hapj.object</a></li><li><a href="hapj.page.html">hapj.page</a></li><li><a href="hapj.string.html">hapj.string</a></li><li><a href="jQuery.html">jQuery</a></li><li><a href="jQuery.ajaxable.html">jQuery.ajaxable</a></li><li><a href="jQuery.fn.html">jQuery.fn</a></li><li><a href="jQuery.verifiable.html">jQuery.verifiable</a></li></ul><h3>Classes</h3><ul><li><a href="hapj.html">hapj</a></li><li><a href="hapj.ajax.html">hapj.ajax</a></li><li><a href="hapj.ui.html">hapj.ui</a></li><li><a href="hapj.ui.fn.html">hapj.ui.fn</a></li><li><a href="jQuery.fn.ajaxable.html">jQuery.fn.ajaxable</a></li><li><a href="jQuery.fn.calendar.html">jQuery.fn.calendar</a></li><li><a href="jQuery.fn.floatable.html">jQuery.fn.floatable</a></li><li><a href="jQuery.fn.lazyload.html">jQuery.fn.lazyload</a></li><li><a href="jQuery.fn.menuable.html">jQuery.fn.menuable</a></li><li><a href="jQuery.fn.selectable.html">jQuery.fn.selectable</a></li><li><a href="jQuery.fn.suggestable.html">jQuery.fn.suggestable</a></li><li><a href="jQuery.fn.switchable.html">jQuery.fn.switchable</a></li><li><a href="jQuery.fn.verifiable.html">jQuery.fn.verifiable</a></li><li><a href="jQuery.verifiable.rules.html">jQuery.verifiable.rules</a></li></ul>
</nav>

<br clear="both">

<footer>
Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Thu Sep 25 2014 20:22:51 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
